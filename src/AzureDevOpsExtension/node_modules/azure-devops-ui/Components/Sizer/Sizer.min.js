import{__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import"./Sizer.css";import*as React from"react";import{ObservableLike}from"../../Core/Observable";import{TimerManagement}from"../../Core/TimerManagement";import{Observer}from"../../Observer";import{css,KeyCode,Mouse}from"../../Util";import{Orientation,Position}from"./Sizer.Props";import{Tooltip}from"../../TooltipEx";import*as Resources from"../../Resources.Widgets";import{Button}from"../../Button";import{Location}from"../../Utilities/Position";import{Callout}from"../../Callout";var Sizer=function(t){function e(e){var r=t.call(this,e)||this;return r.sizerRef=React.createRef(),r.sizerCalloutRef=React.createRef(),r.lastLocation=-1,r.timerManagement=new TimerManagement,r.isSizerSortingFixFFEnabled=!1,r.state={showPortal:!1,resizeInProgress:!1,lastTouchLocation:0,resizeButtonsUsed:!1},r.onDragStart=function(e){e.preventDefault(),r.setState({showPortal:!1}),Mouse.setCapture(r.onMouseCapture)},r.onDragEnd=function(e){Mouse.releaseCapture(r.onMouseCapture)},r.onDragEquivalentButtonClick=function(e,t){e.preventDefault(),r.setState({resizeButtonsUsed:!0,resizeInProgress:!0}),r.updateSize(e,t,!0),r.onSizeEnd()},r.onMouseCapture=function(e){var t,o=r.getMouseLocation(e)-r.state.lastTouchLocation;r.lastLocation+=r.updateSize(e,r.getMouseLocation(e)-r.lastLocation),"mouseup"===e.type&&(r.isSizerSortingFixFFEnabled&&(e.preventDefault(),e.stopPropagation(),document.body.setAttribute("data-resize-active","false"),setTimeout(function(){document.body.removeAttribute("data-resize-active")},0)),0!=o?(r.setState({resizeInProgress:!1,showPortal:!1}),null!=(t=null==(e=r.sizerRef.current)?void 0:e.parentElement)&&t.blur()):r.state.resizeInProgress?(r.setState({showPortal:!0}),null!=(t=null==(o=r.sizerRef.current)?void 0:o.parentElement)&&t.focus()):r.setState({showPortal:!1}),r.onSizeEnd())},r.onKeyDown=function(e){var t,o;e.defaultPrevented||(o=r.props.orientation,r.setState({resizeInProgress:!(t=void 0)}),o===Orientation.row?(e.which===KeyCode.enter&&null!=(o=null==(o=r.sizerRef.current)?void 0:o.parentElement)&&o.focus(),e.which===KeyCode.leftArrow?t=r.updateSize(e.nativeEvent,-1,!0):e.which===KeyCode.rightArrow&&(t=r.updateSize(e.nativeEvent,1,!0))):e.which===KeyCode.upArrow?t=r.updateSize(e.nativeEvent,-1,!0):e.which===KeyCode.downArrow&&(t=r.updateSize(e.nativeEvent,1,!0)),t&&(e.preventDefault(),r.debouncedEnd()))},r.onSizeEnd=function(){r.props.onSizeEnd&&r.props.onSizeEnd(r.props.id)},r.onMouseDown=function(e){e.defaultPrevented||0!==e.button||e.currentTarget!==r.sizerRef.current||(r.isSizerSortingFixFFEnabled&&document.body.setAttribute("data-resize-active","true"),r.lastLocation=r.getMouseLocation(e.nativeEvent),r.state.resizeInProgress||r.setState({lastTouchLocation:r.lastLocation,resizeInProgress:!0}),Mouse.setCapture(r.onMouseCapture),r.setState({showPortal:!0}),e.preventDefault())},r.debouncedEnd=r.timerManagement.debounce(r.onSizeEnd,500,{trailing:!0}),r.handleClickOutside=r.handleClickOutside.bind(r),r.isSizerSortingFixFFEnabled=document.body.classList.contains("sizer-sorting-fix-ff-enabled"),r}return __extends(e,t),e.prototype.render=function(){var t=this,e=this.props.divider;return React.createElement(Tooltip,{text:Resources.SizerAnnouncement,anchorOffset:{horizontal:0,vertical:30},anchorOrigin:{horizontal:Location.center,vertical:Location.start}},React.createElement("div",{"aria-label":this.props.ariaLabel||Resources.SizerAnnouncement,"aria-valuetext":"".concat(ObservableLike.getValue(this.props.size)," pixels wide"),"aria-valuenow":ObservableLike.getValue(this.props.size),className:css(this.props.className,"bolt-sizer",(this.state.resizeInProgress||this.state.showPortal)&&"bolt-sizer-active",this.props.orientation===Orientation.row?"bolt-sizer-row flex-row":"bolt-sizer-column flex-column",e&&"divider"),id:this.props.id,onKeyDown:this.onKeyDown,onMouseDown:this.onMouseDown,onDragStart:this.onDragStart,onDragEnd:this.onDragEnd,ref:this.sizerRef,role:"separator",tabIndex:this.props.tabIndex},this.state.showPortal&&React.createElement(React.Fragment,null,React.createElement(Callout,{anchorElement:this.sizerRef.current,anchorOffset:{horizontal:0,vertical:-50},anchorOrigin:{horizontal:Location.start,vertical:Location.start},calloutOrigin:{horizontal:Location.center,vertical:Location.start},contentShadow:!0,viewportChangeDismiss:!1},React.createElement("div",{className:"flex-row bolt-sizer-callout-row",ref:this.sizerCalloutRef},React.createElement(Button,{ariaLabel:Resources.ColumnButtonSizerLeftAriaLabel,className:"icon-only bolt-sizer-resize-button",iconProps:{iconName:"ChevronLeft"},tooltipProps:{anchorOrigin:{horizontal:Location.center,vertical:Location.end},anchorOffset:{horizontal:0,vertical:-70},text:Resources.ColumnButtonSizerLeft},onMouseDown:function(e){return e.stopPropagation()},onClick:function(e){return t.onDragEquivalentButtonClick(e.nativeEvent,-1)}}),React.createElement(Button,{ariaLabel:Resources.ColumnButtonSizerRightAriaLabel,className:"icon-only bolt-sizer-resize-button",iconProps:{iconName:"ChevronRight"},tooltipProps:{anchorOrigin:{horizontal:Location.center,vertical:Location.end},anchorOffset:{horizontal:0,vertical:-70},text:Resources.ColumnButtonSizerRight},onMouseDown:function(e){return e.stopPropagation()},onClick:function(e){return t.onDragEquivalentButtonClick(e.nativeEvent,1)}}))))))},e.prototype.componentDidMount=function(){document.addEventListener("mousedown",this.handleClickOutside)},e.prototype.componentWillUnmount=function(){Mouse.releaseCapture(this.onMouseCapture),document.removeEventListener("mousedown",this.handleClickOutside),this.isSizerSortingFixFFEnabled&&document.body.removeAttribute("data-resize-active")},e.prototype.getMouseLocation=function(e){return this.props.orientation===Orientation.row?e.pageX:e.pageY},e.prototype.handleClickOutside=function(e){var t=Array.from(e.composedPath()).includes(this.sizerCalloutRef.current);this.state.resizeInProgress&&this.getMouseLocation(e)!==this.state.lastTouchLocation&&!t&&(this.setState({resizeInProgress:!1,showPortal:!1,resizeButtonsUsed:!1}),null!=(t=null==(e=this.sizerRef.current)?void 0:e.parentElement)&&t.blur(),this.onSizeEnd())},e.prototype.updateSize=function(e,t,o){void 0===o&&(o=!1);var r=ObservableLike.getValue(this.props.size),i=this.props.position===Position.far?-1:1,o=o&&this.props.keyboardStepMultiplier||1,t=Math.floor(Math.min(this.props.maxSize,Math.max(this.props.minSize,r+t*i*o)));return this.props.onSize(e,t,this.props.id),(t-r)*i},e.defaultProps={divider:!0,maxSize:1e4,minSize:100},e}(React.Component);function Sized(o){return React.createElement(Observer,{height:o.height,width:o.width},function(e){var t={};return void 0!==e.height&&(t.height=e.height+"px"),void 0!==e.width&&(t.width=e.width+"px"),React.createElement("div",{className:css(o.className,"flex-noshrink"),style:t},o.children)})}export{Sizer,Sized};