import{__assign,__extends}from"tslib";import"../../CommonImports";import"../../Core/core.css";import*as React from"react";import{shimRef}from"../../Util";import{ResponsiveOrientation}from"./ResponsiveLayout.Props";var ResponsiveLayout=function(e){function t(){var f=null!==e&&e.apply(this,arguments)||this;return f.childDetails=[],f.childKeys=[],f.containerRef=React.createRef(),f.hiddenCount=0,f.layoutTimeout=0,f.updateLayout=function(){var e=f.containerRef.current;if(e&&e.children.length){var t=f.hiddenCount,i=e.getBoundingClientRect(),n=0,o=0,r=!1;f.childDetails&&e.children.length===f.childDetails.length||(f.childDetails=[],r=!0);for(var l=0;l<e.children.length;l++){var a,s,h=e.children[l].getBoundingClientRect();r?(a={appliedSize:0,clientRect:h},(s=window.getComputedStyle(e.children[l]))&&(a.margins={left:parseInt(s.getPropertyValue("margin-left")||"0"),right:parseInt(s.getPropertyValue("margin-right")||"0")}),f.childDetails.push(a)):f.childDetails[l].clientRect=h,f.props.ignoredChildren&&0<=f.props.ignoredChildren.indexOf(l)&&(o+=f.props.orientation===ResponsiveOrientation.Vertical?h.height:h.width)}n=f.props.orientation===ResponsiveOrientation.Vertical?Math.floor(f.childDetails[f.childDetails.length-1].clientRect.bottom-f.childDetails[0].clientRect.top):Math.floor(f.childDetails[f.childDetails.length-1].clientRect.right-f.childDetails[0].clientRect.left),n-=Math.floor(o);i=Math.floor(f.props.orientation===ResponsiveOrientation.Vertical?i.height:i.width);if(i<=n)for(var d=i-n;d<0&&f.hiddenCount<f.props.responsiveChildren.length;){var c=f.props.responsiveChildren[f.hiddenCount],p=f.childDetails[c],u=Math.ceil(f.props.orientation===ResponsiveOrientation.Vertical?p.clientRect.height:p.clientRect.width);d+=u+=(p.margins?p.margins.left+p.margins.right:0)||8,p.hidden=!0,p.appliedSize=u,f.hiddenCount++}else if(n<i)for(d=i-n;0<f.hiddenCount;){c=f.props.responsiveChildren[f.hiddenCount-1];if((p=f.childDetails[c]).appliedSize>=d)break;d-=p.appliedSize,p.hidden=!1,f.hiddenCount--}t!=f.hiddenCount&&(f.layoutTimeout=window.setTimeout(function(){f.layoutTimeout=0,f.props.onLayoutChange&&f.props.onLayoutChange(f.hiddenCount),f.forceUpdate()},0))}},f}return __extends(t,e),t.prototype.render=function(){var i=this,n=[],e=React.Children.only(this.props.children),e=(this.containerRef=shimRef(e),React.cloneElement(e,__assign(__assign({},e.props),{ref:this.containerRef}),React.Children.map(e.props.children,function(e,t){return e.key||(console.warn("All children MUST have a unique key"),e.key=t),n[t]=e.key,i.childDetails&&i.childDetails[t]&&i.childDetails[t].hidden?React.createElement("div",{key:"PH"+t,className:"responsive-placeholder"}):e})));if(this.childKeys)if(this.childKeys.length!==n.length)this.resetLayout();else for(var t=0;t<n.length;t++)if(this.childKeys[t]!==n[t]){this.resetLayout();break}return this.childKeys=n,e},t.prototype.componentDidMount=function(){window.addEventListener("resize",this.updateLayout),this.updateLayout()},t.prototype.componentDidUpdate=function(){this.updateLayout()},t.prototype.componentWillUnmount=function(){this.layoutTimeout&&(window.clearTimeout(this.layoutTimeout),this.layoutTimeout=0),window.removeEventListener("resize",this.updateLayout)},t.prototype.resetLayout=function(){this.childDetails=void 0,this.hiddenCount=0},t}(React.Component);export{ResponsiveLayout};