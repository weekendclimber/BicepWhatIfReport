import"../../CommonImports";import"../../Core/core.css";import"./DropdownList.css";import"./List.css";import"./ListDropIndicator.css";import*as React from"react";import{beginDragOperation,DragDropEffect,DragImage}from"../../Utilities/DragDrop";import{beginDragOperationOptimized,DragImageOptimized}from"../../Utilities/DragDropInternal";import{cellFromEvent}from"./List";var DragAndDropOptimizationsBodyClassName="dnd-behaviors-optimizations-enabled",ListDragSourceBehavior=function(){function t(t){var s=this;this.initialize=function(t,e,o){s.dragDroppableUI=e,s.eventDispatch=o,s.eventDispatch.addEventListener("pointerdown",s.onPointerDown),s.eventDispatch.addEventListener("dragstart",s.onDragStart),s.eventDispatch.addEventListener("dragend",s.onDragEnd),s.eventDispatch.addEventListener("dragover",s.onDragging),s.itemProvider=t.itemProvider},this.onDragging=function(t){s.options.onDragging?s.options.onDragging(t):s.onDraggingDefault()},this.onDraggingDefault=function(){var t,e,o,a,r,i,n=null==(n=null==(n=s.dragDroppableUI)?void 0:n.currentElement)?void 0:n.current;n&&(a=(t=n.getBoundingClientRect()).top,t=t.bottom,e=.05*n.offsetHeight,o=document.body.classList.contains(DragAndDropOptimizationsBodyClassName)?null==(o=s.operationOptimized)?void 0:o.value.y:null==(o=null==(o=s.operation)?void 0:o.y)?void 0:o.value)&&(a=o<a+e,r=0<n.scrollTop,i=n.scrollTop+n.offsetHeight<n.scrollHeight,t-e<o&&i?n.scrollTo({top:n.scrollTop+20}):a&&r&&n.scrollTo({top:n.scrollTop-20}))},this.onDragEnd=function(t){0<=cellFromEvent(t).rowIndex&&s.options.onDragEnd&&s.options.onDragEnd(t),s.dragDroppableUI.removeOverlay("drag-source-item"),s.dragImageData=void 0},this.onDragStart=function(t){var e;t.detail.dataTransfer?0<=(e=cellFromEvent(t).rowIndex)&&(s.options.onDragStart&&s.options.onDragStart(t),t.detail.dataTransfer.effectAllowed!==DragDropEffect.none)&&(s.dragDroppableUI.addOverlay("drag-source-item",e,s.renderDragSourceItemOverlay),void 0===s.dragImageData)&&(s.dragImageData={image:s.options.renderDragImage(t)}):(t.stopPropagation(),t.preventDefault())},this.onPointerDown=function(t){0===t.button&&s.beginDrag(t)},this.renderDragSourceItemOverlay=function(t){return document.body.classList.contains(DragAndDropOptimizationsBodyClassName)?React.createElement(React.Fragment,null,React.createElement("div",{className:"bolt-list-drag-source-item flex-grow"}),s.operationOptimized&&s.dragImageData&&React.createElement(DragImageOptimized,{operation:s.operationOptimized},s.dragImageData.image)):React.createElement(React.Fragment,null,React.createElement("div",{className:"bolt-list-drag-source-item flex-grow"}),s.operation&&s.dragImageData&&React.createElement(DragImage,{operation:s.operation},s.dragImageData.image))},this.setDragImage=function(t,e,o){s.dragImageData={image:t,xOffset:e,yOffset:o}},this.options=t}return t.prototype.componentDidUpdate=function(t){this.itemProvider=t.itemProvider},t.prototype.componentWillUnmount=function(){var t;null!=(t=this.eventDispatch)&&t.removeEventListener("pointerdown",this.onPointerDown),null!=(t=this.eventDispatch)&&t.removeEventListener("dragstart",this.onDragStart),null!=(t=this.eventDispatch)&&t.removeEventListener("dragend",this.onDragEnd),null!=(t=this.eventDispatch)&&t.removeEventListener("dragover",this.onDragging)},t.prototype.beginDrag=function(t){var e,o=cellFromEvent(t).rowIndex;this.itemProvider&&0<=o&&(e=this.itemProvider.value[o],document.body.classList.contains(DragAndDropOptimizationsBodyClassName)?this.operationOptimized=beginDragOperationOptimized(t,{data:e,dropEffect:DragDropEffect.none,secondaryData:{index:o,sourceId:this.options.id},setDragImage:this.setDragImage,type:this.options.type}):this.operation=beginDragOperation(t,{data:e,dropEffect:DragDropEffect.none,secondaryData:{index:o,sourceId:this.options.id},setDragImage:this.setDragImage,type:this.options.type}))},t}();export{ListDragSourceBehavior};