import*as React from"react";import{DragDropEffect,dispatchCustomDragEvent}from"../Utilities/DragDrop";import{ObservableValue}from"../Core/Observable";import{Portal}from"../Portal";import{css,getPointByEventType,Pointer}from"../Util";import{distance}from"./Position";var DragDropManagerOptimized=function(){function e(){var a=this;this.onEventCaptured=function(e){var t,r,n=e.type;"pointermove"===n?a.dragInProgress?(r=a.getTargetFromEvent(e))&&(t=getPointByEventType(e),a.operation&&(a.operation.value={x:t.x,y:t.y}),dispatchCustomDragEvent("dragover",r,e,a.dataTransfer),e.preventDefault()):a.potentialDragInProgress&&(t=getPointByEventType(e),distance(a.initialCoordinates,t)>a.minimumPixelsForDrag)&&(dispatchCustomDragEvent("dragstart",a.dragSourceElement,e,a.dataTransfer),a.dataTransfer.effectAllowed===DragDropEffect.none?(a.potentialDragInProgress=!1,a.endDrag()):(a.dragInProgress=!0,a.operation&&(a.operation.value={x:t.x,y:t.y})),e.preventDefault()):"pointerup"===n&&(a.dragInProgress&&(r=a.getTargetFromEvent(e),dispatchCustomDragEvent("dragend",a.dragSourceElement,e,a.dataTransfer),r)&&a.dataTransfer.dropEffect!==DragDropEffect.none&&dispatchCustomDragEvent("drop",r,e,a.dataTransfer),a.endDrag())},this.onPointerLeave=function(e){a.dataTransfer.dropEffect=DragDropEffect.none},this.onPointerOut=function(e){e.target&&(a.dataTransfer.dropEffect=DragDropEffect.none,dispatchCustomDragEvent("dragexit",e.target,e,a.dataTransfer))},this.onPointerOver=function(e){e.target&&(a.dataTransfer.dropEffect=DragDropEffect.none,dispatchCustomDragEvent("dragenter",e.target,e,a.dataTransfer))}}return e.prototype.beginDragOperationOptimized=function(e,t,r){return void 0===r&&(r=4),this.operation=void 0,this.dragInProgress||"pointerdown"===e.type&&(this.startDrag(e,r,t),this.initialCoordinates={x:e.clientX,y:e.clientY},Pointer.setCapture(this.onEventCaptured),document.body.addEventListener("pointerout",this.onPointerOut,!0),document.body.addEventListener("pointerover",this.onPointerOver,!0),document.body.addEventListener("pointerleave",this.onPointerLeave),this.operation=new ObservableValue({x:void 0,y:void 0})),this.operation},Object.defineProperty(e.prototype,"isDragInProgress",{get:function(){return this.dragInProgress},enumerable:!1,configurable:!0}),e.prototype.endDrag=function(){document.body.removeEventListener("pointerout",this.onPointerOut),document.body.removeEventListener("pointerover",this.onPointerOver),document.body.removeEventListener("pointerleave",this.onPointerLeave),this.dragInProgress=!1},e.prototype.getTargetFromEvent=function(e){return e.target},e.prototype.startDrag=function(e,t,r){this.potentialDragInProgress=!0,this.dragSourceElement=e.target,this.minimumPixelsForDrag=t,this.dataTransfer=r},e}(),dragDropManagerOptimized=new DragDropManagerOptimized;function beginDragOperationOptimized(e,t,r){return dragDropManagerOptimized.beginDragOperationOptimized(e,t,r)}var DragImageOptimized=React.memo(function(e){function t(){cancelAnimationFrame(d.current),d.current=requestAnimationFrame(function(){var e,t;null!=(e=s.current)&&e.style&&n.value&&n.value.x&&n.value.y&&(e=n.value.x+o,t=n.value.y+i,s.current.style.transform="translate3d(".concat(e,"px, ").concat(t,"px, 0)"))})}var r=e.className,n=e.operation,a=e.xOffset,o=void 0===a?5:a,a=e.yOffset,i=void 0===a?5:a,s=React.useRef(null),d=React.useRef(0);return React.useEffect(function(){return n.subscribe(t),function(){n.unsubscribe(t)}},[]),React.createElement(React.Fragment,null,React.createElement(Portal,{className:"bolt-drag-image-portal"},React.createElement("div",{className:css(r,"bolt-drag-image depth-16 absolute flex-row flex-center scroll-hidden justify-center"),ref:s},e.children)))});export{beginDragOperationOptimized,DragImageOptimized};